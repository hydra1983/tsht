#!/usr/bin/env tsht

plan 1

set -e

testproject="$PWD/test-project"
trap "rm -rf $testproject" EXIT

tsht_repo="../../../"
sha_initial="2fff5b47cb08dec945c5ebd989b55ffac016f8ba"
sha_current=$(cd $tsht_repo && git rev-parse origin/master)

mkdir "$testproject"
cp "$tsht_repo/tsht" "$testproject/"
git clone "$tsht_repo" "$testproject/.tsht"
cd "$testproject/.tsht"
git checkout master
git reset --hard "$sha_initial"
cd "$testproject"

TSHTLIB=""
equals "$sha_initial" "$(cd $testproject/.tsht; git rev-parse HEAD)" "HEAD is $sha_initial"
./tsht --update
equals "$sha_current" "$(cd $testproject/.tsht; git rev-parse HEAD)" "HEAD is $sha_current"
